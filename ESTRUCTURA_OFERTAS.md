# ðŸ“Š Estructura del Sistema de Ofertas de Compra

## ðŸ—ï¸ Arquitectura del Sistema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SISTEMA DE OFERTAS                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BASE DE DATOS                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚     property_sale_offers (Extendida)       â”‚            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  â”‚ - id (uuid)                                â”‚            â”‚
â”‚  â”‚ - property_id â†’ properties                 â”‚            â”‚
â”‚  â”‚ - buyer_id â†’ auth.users                    â”‚            â”‚
â”‚  â”‚                                            â”‚            â”‚
â”‚  â”‚ [Campos Generales]                         â”‚            â”‚
â”‚  â”‚ - buyer_email, buyer_phone                 â”‚            â”‚
â”‚  â”‚ - offer_amount, message                    â”‚            â”‚
â”‚  â”‚ - status (pendiente, aceptada, etc.)       â”‚            â”‚
â”‚  â”‚                                            â”‚            â”‚
â”‚  â”‚ [Persona Natural/JurÃ­dica]                 â”‚            â”‚
â”‚  â”‚ - entity_type (natural/juridica)           â”‚            â”‚
â”‚  â”‚ - buyer_name, buyer_lastname, buyer_rut    â”‚            â”‚
â”‚  â”‚ - company_name, company_rut                â”‚            â”‚
â”‚  â”‚ - legal_representative_name                â”‚            â”‚
â”‚  â”‚ - legal_representative_rut                 â”‚            â”‚
â”‚  â”‚                                            â”‚            â”‚
â”‚  â”‚ [Financiamiento]                           â”‚            â”‚
â”‚  â”‚ - has_preapproved_credit                   â”‚            â”‚
â”‚  â”‚ - credit_proof_url                         â”‚            â”‚
â”‚  â”‚ - has_bank_executive                       â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                       â”‚                                     â”‚
â”‚                       â”‚ 1:N                                 â”‚
â”‚                       â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚      offer_bank_executives (Nueva)         â”‚            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  â”‚ - id (uuid)                                â”‚            â”‚
â”‚  â”‚ - offer_id â†’ property_sale_offers          â”‚            â”‚
â”‚  â”‚ - name (NOT NULL)                          â”‚            â”‚
â”‚  â”‚ - email (NOT NULL, validado)               â”‚            â”‚
â”‚  â”‚ - banco (NOT NULL)                         â”‚            â”‚
â”‚  â”‚ - phone (opcional)                         â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚  property_sale_offer_documents (Existe)    â”‚            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  â”‚ Almacena documentos adjuntos a ofertas     â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FRONTEND - RUTAS                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  /ofertas/nueva/:propertyId  â”€â”                            â”‚
â”‚                               â”œâ”€â”€â–º SaleOfferPage            â”‚
â”‚  /offers/new/:propertyId     â”€â”˜                            â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  COMPONENTES REACT                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  SaleOfferPage.tsx                                          â”‚
â”‚  â”œâ”€ Carga propiedad desde Supabase                          â”‚
â”‚  â”œâ”€ Valida tipo y estado de propiedad                       â”‚
â”‚  â”œâ”€ Maneja estados de loading/error                         â”‚
â”‚  â””â”€ Renderiza â–¼                                             â”‚
â”‚                                                             â”‚
â”‚     SaleOfferForm.tsx                                       â”‚
â”‚     â”œâ”€ [Selector de Tipo de Persona]                        â”‚
â”‚     â”‚   â”œâ”€ Persona Natural                                  â”‚
â”‚     â”‚   â””â”€ Persona JurÃ­dica                                 â”‚
â”‚     â”‚                                                        â”‚
â”‚     â”œâ”€ [Datos del Ofertante]                                â”‚
â”‚     â”‚   â”œâ”€ Natural: nombre, apellidos, RUT                  â”‚
â”‚     â”‚   â””â”€ JurÃ­dica: razÃ³n social, RUT empresa,             â”‚
â”‚     â”‚                representante legal                     â”‚
â”‚     â”‚                                                        â”‚
â”‚     â”œâ”€ [Contacto]                                           â”‚
â”‚     â”‚   â”œâ”€ Email                                            â”‚
â”‚     â”‚   â””â”€ TelÃ©fono                                         â”‚
â”‚     â”‚                                                        â”‚
â”‚     â”œâ”€ [Oferta]                                             â”‚
â”‚     â”‚   â”œâ”€ Monto (con preview CLP)                          â”‚
â”‚     â”‚   â””â”€ Mensaje al propietario                           â”‚
â”‚     â”‚                                                        â”‚
â”‚     â”œâ”€ [Financiamiento]                                     â”‚
â”‚     â”‚   â”œâ”€ â˜ CrÃ©dito preaprobado                            â”‚
â”‚     â”‚   â”‚   â””â”€ Upload comprobante (opcional)                â”‚
â”‚     â”‚   â”‚                                                    â”‚
â”‚     â”‚   â””â”€ â˜ Ejecutivo bancario                             â”‚
â”‚     â”‚       â””â”€ [Array de Ejecutivos]                        â”‚
â”‚     â”‚           â”œâ”€ Ejecutivo 1                              â”‚
â”‚     â”‚           â”‚   â”œâ”€ Nombre                               â”‚
â”‚     â”‚           â”‚   â”œâ”€ Email                                â”‚
â”‚     â”‚           â”‚   â”œâ”€ Banco (selector)                     â”‚
â”‚     â”‚           â”‚   â””â”€ TelÃ©fono (opcional)                  â”‚
â”‚     â”‚           â”‚                                            â”‚
â”‚     â”‚           â”œâ”€ [+ Agregar otro ejecutivo]               â”‚
â”‚     â”‚           â””â”€ [- Remover ejecutivo]                    â”‚
â”‚     â”‚                                                        â”‚
â”‚     â”œâ”€ [Documentos Respaldatorios]                          â”‚
â”‚     â”‚   â””â”€ Upload mÃºltiple (opcional)                       â”‚
â”‚     â”‚                                                        â”‚
â”‚     â”œâ”€ [Validaciones]                                       â”‚
â”‚     â”‚   â”œâ”€ Campos segÃºn tipo de persona                     â”‚
â”‚     â”‚   â”œâ”€ Monto > 0                                        â”‚
â”‚     â”‚   â”œâ”€ Mensaje requerido                                â”‚
â”‚     â”‚   â””â”€ Al menos 1 ejecutivo si marcÃ³ checkbox           â”‚
â”‚     â”‚                                                        â”‚
â”‚     â””â”€ [Botones]                                            â”‚
â”‚         â”œâ”€ Cancelar                                         â”‚
â”‚         â””â”€ Enviar Oferta                                    â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FLUJO DE DATOS                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. Usuario en PropertyDetailsPage                          â”‚
â”‚     â””â”€â–º Clic "Hacer Oferta de Compra"                       â”‚
â”‚                                                             â”‚
â”‚  2. Navigate â†’ /ofertas/nueva/:propertyId                   â”‚
â”‚     â””â”€â–º SaleOfferPage carga                                 â”‚
â”‚                                                             â”‚
â”‚  3. SaleOfferPage                                           â”‚
â”‚     â”œâ”€â–º Fetch property data                                 â”‚
â”‚     â”œâ”€â–º Valida tipo = venta                                 â”‚
â”‚     â”œâ”€â–º Valida status = disponible/activa                   â”‚
â”‚     â””â”€â–º Renderiza SaleOfferForm                             â”‚
â”‚                                                             â”‚
â”‚  4. Usuario completa formulario                             â”‚
â”‚     â”œâ”€â–º Selecciona tipo persona                             â”‚
â”‚     â”œâ”€â–º Completa datos                                      â”‚
â”‚     â”œâ”€â–º Agrega ejecutivos (opcional)                        â”‚
â”‚     â”œâ”€â–º Sube documentos (opcional)                          â”‚
â”‚     â””â”€â–º Clic "Enviar Oferta"                                â”‚
â”‚                                                             â”‚
â”‚  5. SaleOfferForm.handleSubmit()                            â”‚
â”‚     â”œâ”€â–º Valida formulario                                   â”‚
â”‚     â”œâ”€â–º Sube documentos a Storage                           â”‚
â”‚     â”œâ”€â–º INSERT property_sale_offers                         â”‚
â”‚     â”œâ”€â–º INSERT offer_bank_executives (si existen)           â”‚
â”‚     â”œâ”€â–º INSERT property_sale_offer_documents (si existen)   â”‚
â”‚     â””â”€â–º Navigate â†’ /my-offers                               â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  SEGURIDAD (RLS)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  property_sale_offers:                                      â”‚
â”‚  âœ“ Comprador ve sus ofertas                                 â”‚
â”‚  âœ“ Vendedor ve ofertas en sus propiedades                   â”‚
â”‚  âœ“ Autenticados pueden crear ofertas                        â”‚
â”‚  âœ“ Comprador actualiza ofertas pendientes                   â”‚
â”‚  âœ“ Vendedor actualiza ofertas en sus propiedades            â”‚
â”‚                                                             â”‚
â”‚  offer_bank_executives:                                     â”‚
â”‚  âœ“ Comprador CRUD en sus ofertas                            â”‚
â”‚  âœ“ Vendedor READ en ofertas de sus propiedades              â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 VALIDACIONES                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Frontend (SaleOfferForm):                                  â”‚
â”‚  âœ“ Tipo de persona seleccionado                             â”‚
â”‚  âœ“ Campos segÃºn tipo (natural/jurÃ­dica)                     â”‚
â”‚  âœ“ Email y telÃ©fono requeridos                              â”‚
â”‚  âœ“ Monto > 0                                                â”‚
â”‚  âœ“ Mensaje no vacÃ­o                                         â”‚
â”‚  âœ“ Si has_bank_executive=true â†’ min 1 ejecutivo             â”‚
â”‚  âœ“ Ejecutivos: nombre, email, banco completos               â”‚
â”‚                                                             â”‚
â”‚  Backend (Database):                                        â”‚
â”‚  âœ“ CHECK (offer_amount > 0)                                 â”‚
â”‚  âœ“ CHECK (email vÃ¡lido en executives)                       â”‚
â”‚  âœ“ REFERENCES property_id â†’ properties                      â”‚
â”‚  âœ“ REFERENCES buyer_id â†’ auth.users                         â”‚
â”‚  âœ“ NOT NULL en campos requeridos                            â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

