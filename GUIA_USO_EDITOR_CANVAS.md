# ğŸ“š GuÃ­a de Uso: Editor Canvas de Contratos

## ğŸ¯ IntroducciÃ³n

El **Editor Canvas** es una herramienta visual e intuitiva para crear y editar contratos de arrendamiento directamente en el navegador. Permite modificar cualquier parte del contrato con un sistema de ediciÃ³n en vivo.

---

## ğŸš€ Acceso al Editor

### OpciÃ³n 1: Desde la Lista de Contratos

1. Ve a la pÃ¡gina **Contratos** (`/contracts`)
2. Busca el contrato que deseas editar
3. Click en el botÃ³n **ğŸŸ£ Editar Contrato**

### OpciÃ³n 2: Desde la Vista del Contrato

1. Abre un contrato en modo vista (`/contract/:id`)
2. Click en el botÃ³n **Editar** en la barra de acciones
3. Se abrirÃ¡ el editor canvas

---

## ğŸ–Šï¸ EdiciÃ³n del Contrato

### Editar Cualquier Texto

1. **Haz click** en cualquier texto que quieras editar
2. AparecerÃ¡ un **campo de ediciÃ³n** con fondo azul
3. **Escribe** tus cambios
4. **Click fuera** del campo o presiona `Tab` para salir del modo ediciÃ³n

#### Elementos Editables:
- âœï¸ **TÃ­tulo del contrato**
- âœï¸ **Comparecencia** (texto introductorio)
- âœï¸ **TÃ­tulo de cada clÃ¡usula**
- âœï¸ **Contenido de cada clÃ¡usula**
- âœï¸ **Texto de cierre**
- âœï¸ **InformaciÃ³n de firmantes** (nombre, RUT, rol)

### Visual de EdiciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Modo Vista (Hover)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ CONTRATO DE ARRENDAMIENTO      âœï¸ â”‚  â”‚ â† Icono aparece al pasar mouse
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Modo EdiciÃ³n (Activo)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [CONTRATO DE ARRENDAMIENTO]       â”‚  â”‚ â† Fondo azul, campo editable
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## â• Agregar Elementos

### Agregar ClÃ¡usula

1. Click en **â• AÃ±adir ClÃ¡usula** (barra superior)
2. Se agrega una nueva clÃ¡usula al final
3. Edita el tÃ­tulo y contenido de la nueva clÃ¡usula

### Agregar Firmante

1. DesplÃ¡zate hasta la secciÃ³n de firmas
2. Click en **â• AÃ±adir Firmante** (al final de la lista)
3. Completa: ROL, Nombre, RUT

---

## ğŸ—‘ï¸ Eliminar Elementos

### Eliminar ClÃ¡usula

1. Pasa el mouse sobre el tÃ­tulo de la clÃ¡usula
2. Aparece un botÃ³n **ğŸ—‘ï¸ rojo** a la derecha
3. Click para eliminar (sin confirmaciÃ³n, ten cuidado)

### Eliminar Firmante

1. Pasa el mouse sobre la informaciÃ³n del firmante
2. Aparece un botÃ³n **ğŸ—‘ï¸ rojo** a la derecha
3. Click para eliminar

---

## ğŸ’¾ Guardar Cambios

### Guardar en Base de Datos

1. Click en **ğŸ’¾ Guardar Cambios** (barra superior, botÃ³n morado)
2. Espera el mensaje "Guardando..."
3. VerÃ¡s **âœ“ Guardado** cuando se complete

### Estados del BotÃ³n:

| Estado | Apariencia | Significado |
|--------|-----------|-------------|
| Normal | ğŸŸ£ Guardar Cambios | Listo para guardar |
| Guardando | âšª Guardando... | Procesando |
| Ã‰xito | ğŸŸ¢ Guardado âœ“ | Guardado exitoso (3 seg) |
| Error | ğŸ”´ Error | Muestra alerta con detalles |

**âš ï¸ Importante:** Los cambios NO se guardan automÃ¡ticamente. Debes hacer click en "Guardar Cambios".

---

## ğŸ“„ Descargar PDF

### Generar PDF del Contrato

1. Click en **ğŸ“¥ Descargar PDF** (barra superior, botÃ³n verde)
2. El sistema genera el PDF con:
   - âœ… MÃ¡rgenes perfectos (1.5cm en todos los lados)
   - âœ… PaginaciÃ³n automÃ¡tica
   - âœ… Fuente serif profesional
   - âœ… Texto justificado
3. Se descarga automÃ¡ticamente como `contrato-final-profesional.pdf`

**ğŸ’¡ Tip:** El PDF se genera con el estado actual del contrato, incluso si no has guardado los cambios en la base de datos.

---

## ğŸ¨ Interfaz del Editor

### Barra de Herramientas (Superior)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Editor Canvas de Contrato                                     â”‚
â”‚  Lienzo de Documento DinÃ¡mico                                  â”‚
â”‚                                                                 â”‚
â”‚  [â• AÃ±adir ClÃ¡usula] [ğŸ’¾ Guardar Cambios] [ğŸ“¥ Descargar PDF] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Estructura del Documento

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                      â”‚
â”‚    CONTRATO DE ARRENDAMIENTO         â”‚ â† TÃ­tulo (editable)
â”‚                                      â”‚
â”‚  Comparecen de una parte...          â”‚ â† Comparecencia (editable)
â”‚                                      â”‚
â”‚  PRIMERA: PROPIEDAD ARRENDADA  ğŸ—‘ï¸   â”‚ â† ClÃ¡usula con botÃ³n eliminar
â”‚  El arrendador da en arrendamiento...â”‚
â”‚                                      â”‚
â”‚  SEGUNDA: RENTA                ğŸ—‘ï¸   â”‚
â”‚  La renta mensual serÃ¡...            â”‚
â”‚                                      â”‚
â”‚  [â• AÃ±adir ClÃ¡usula]                â”‚
â”‚                                      â”‚
â”‚  En comprobante de lo pactado...     â”‚ â† Cierre (editable)
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚
â”‚  ARRENDADOR                    ğŸ—‘ï¸   â”‚ â† Firmante con botÃ³n eliminar
â”‚  Juan PÃ©rez                          â”‚
â”‚  12.345.678-9                        â”‚
â”‚                                      â”‚
â”‚  [          Espacio firma        ]   â”‚
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚
â”‚  ARRENDATARIO                  ğŸ—‘ï¸   â”‚
â”‚  MarÃ­a GonzÃ¡lez                      â”‚
â”‚  98.765.432-1                        â”‚
â”‚                                      â”‚
â”‚  [          Espacio firma        ]   â”‚
â”‚                                      â”‚
â”‚  [â• AÃ±adir Firmante]                â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âŒ¨ï¸ Atajos y Trucos

### NavegaciÃ³n RÃ¡pida

- **Click** â†’ Activa ediciÃ³n
- **Tab** â†’ Sale del campo actual (guarda el cambio)
- **Click fuera** â†’ Sale del campo actual (guarda el cambio)
- **Esc** â†’ (No implementado aÃºn, sale con los cambios)

### EdiciÃ³n Eficiente

1. **TÃ­tulos de clÃ¡usulas:** Ãšsalos en MAYÃšSCULAS para mantener el formato profesional
2. **Contenido extenso:** El campo de texto se expande automÃ¡ticamente
3. **Saltos de lÃ­nea:** Presiona `Enter` normalmente dentro del campo
4. **Formato:** El texto en modo vista se justifica automÃ¡ticamente

### Buenas PrÃ¡cticas

- âœ… Guarda frecuentemente (cada 5-10 minutos)
- âœ… Revisa el PDF antes de enviar
- âœ… Verifica los datos de firmantes
- âœ… Usa tÃ­tulos descriptivos en clÃ¡usulas
- âœ… MantÃ©n consistencia en numeraciÃ³n (PRIMERA, SEGUNDA, etc.)

---

## ğŸ”§ ResoluciÃ³n de Problemas

### El botÃ³n "Guardar" no aparece

**Causa:** El componente no recibiÃ³ el `contractId`  
**SoluciÃ³n:** Verifica que accediste al editor desde una URL vÃ¡lida con ID

### Error al guardar: "No se puede guardar"

**Causa:** No tienes permisos para editar este contrato  
**SoluciÃ³n:** Solo el propietario de la propiedad puede editar el contrato

### Los cambios no se reflejan despuÃ©s de guardar

**Causa 1:** Error de red o base de datos  
**SoluciÃ³n:** Revisa la consola del navegador (F12) para ver errores

**Causa 2:** ActualizaciÃ³n pendiente  
**SoluciÃ³n:** Recarga la pÃ¡gina y verifica si los cambios se guardaron

### El PDF no se descarga

**Causa:** Error en la generaciÃ³n del canvas  
**SoluciÃ³n:**
1. Sal del modo ediciÃ³n (click fuera de cualquier campo)
2. Espera 1 segundo
3. Vuelve a intentar descargar

### El texto se corta en el PDF

**Causa:** Contenido muy largo sin saltos de pÃ¡gina  
**SoluciÃ³n:** El sistema hace paginaciÃ³n automÃ¡tica, pero si hay problemas:
1. Divide clÃ¡usulas muy largas en varias clÃ¡usulas mÃ¡s cortas
2. Usa saltos de pÃ¡rrafo dentro de las clÃ¡usulas

---

## ğŸ“Š InformaciÃ³n TÃ©cnica

### Datos que se Guardan

Cuando haces click en "Guardar Cambios", se actualiza:

```json
{
  "contract_content": {
    "titulo": "CONTRATO DE ARRENDAMIENTO",
    "comparecencia": "Comparecen de una parte...",
    "clausulas": [
      {
        "id": "1",
        "titulo": "PRIMERA",
        "contenido": "..."
      }
    ],
    "cierre": "En comprobante...",
    "firmantes": [
      {
        "id": "1",
        "nombre": "Juan PÃ©rez",
        "rut": "12.345.678-9",
        "rol": "ARRENDADOR"
      }
    ]
  },
  "updated_at": "2025-10-09T..."
}
```

### Compatibilidad

El editor es compatible con:
- âœ… Navegadores modernos (Chrome, Firefox, Edge, Safari)
- âœ… Dispositivos mÃ³viles (con limitaciones en ediciÃ³n)
- âœ… Contratos existentes con estructura canvas
- âš ï¸ Contratos HTML antiguos (se convierten automÃ¡ticamente)

---

## ğŸ“ Ejemplos de Uso

### Caso 1: Editar Monto de Renta

1. Localiza la clÃ¡usula "RENTA" o "PRECIO"
2. Click en el contenido de la clÃ¡usula
3. Cambia el monto: `$500.000` â†’ `$550.000`
4. Click fuera del campo
5. Click en "Guardar Cambios"

### Caso 2: Agregar ClÃ¡usula de Mascotas

1. Click en "AÃ±adir ClÃ¡usula"
2. Click en el tÃ­tulo de la nueva clÃ¡usula
3. Escribe: `SEXTA: MASCOTAS`
4. Click en el contenido
5. Escribe: `El arrendatario podrÃ¡ tener hasta dos mascotas pequeÃ±as...`
6. Click en "Guardar Cambios"

### Caso 3: Modificar Datos de Firmante

1. DesplÃ¡zate a la secciÃ³n de firmas
2. Click en el nombre del arrendatario
3. Corrige el nombre
4. Click en el RUT
5. Corrige el RUT
6. Click en "Guardar Cambios"

### Caso 4: Descargar Contrato Final

1. Revisa que todos los datos sean correctos
2. Click en "Descargar PDF"
3. Abre el PDF descargado
4. Verifica mÃ¡rgenes, paginaciÃ³n, contenido
5. EnvÃ­a el PDF al cliente o imprÃ­melo

---

## ğŸ“ Soporte

### Recursos Adicionales:

- ğŸ“– **DocumentaciÃ³n tÃ©cnica:** Ver `INTEGRACION_CANVAS_EDITOR_COMPLETA.md`
- ğŸ” **VerificaciÃ³n:** Ejecutar `verificar_integracion_canvas.sql`
- ğŸ› **Reportar problemas:** Consulta con el equipo de desarrollo

### Logs para Debugging:

Si encuentras problemas, abre la consola del navegador (F12) y busca:
- âœ… `Contrato guardado exitosamente` â†’ Guardado OK
- âŒ `Error al guardar el contrato` â†’ Ver detalles del error
- ğŸ” Mensajes de red en la pestaÃ±a "Network"

---

## âœ¨ Tips Pro

1. **Usa plantillas:** Si vas a crear muchos contratos similares, crea uno "maestro" y duplÃ­calo
2. **Guarda versiones:** Descarga el PDF de cada versiÃ³n importante antes de hacer cambios grandes
3. **Revisa en PDF:** Siempre descarga y revisa el PDF antes de firmar
4. **Nomenclatura:** MantÃ©n consistencia en nombres de clÃ¡usulas (PRIMERA, SEGUNDA, etc.)
5. **Backup:** El sistema guarda `updated_at`, pero considera hacer capturas de pantalla de cambios importantes

---

**ğŸ‰ Â¡Listo! Ya estÃ¡s preparado para usar el Editor Canvas de Contratos de forma profesional.**

